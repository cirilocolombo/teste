event ue_excel();long		ll_retorno 
string 	ls_path
string	ls_file

if not ib_excel then
	MessageBox(gs_titulo, 'Relatório não configurado para gerar Excel', Exclamation!)
	Return
end if

select ds_caminho_geracao_nf
  into :ls_path
  from parametro
 where trava = :gi_empresa;
if IsNull(ls_path) then ls_path = ''

ls_path = ls_path + 'email\arquivo.xls'

ll_retorno = GetFileSaveName("Salvar", ls_path, ls_file, "xls", "Arquivos XLS (*.xls),*.xls")
if ll_retorno = -1 then
	MessageBox(gs_titulo, 'Não foi possível criar o arquivo')
	Return
end if
if IsNull(ls_path) or trim(ls_path) = '' then Return

if uf_save_dw_as_excel( dw_1, ls_path ) = 1 then 
	if MessageBox(gs_titulo, "Exportação para Excel efetuada com sucesso!~n~rDeseja abrir o arquivo gerado?", question!, yesNo!) = 1 then 
		Run ('rundll32 SHELL32.DLL,ShellExec_RunDLL ' + ls_path)
	end if 
else
	MessageBox("Aviso", "Não foi possível converter para excel. Erro ao gravar o arquivo.", Exclamation!)
	return
end if 

end event